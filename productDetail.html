<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Skincare Master</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.2/css/all.css" integrity="sha384-/rXc/GQVaYpyDdyxK+ecHPVYJSN9bmVFBvjA/9eOB+pb3F2w2N6fc5qB9Ew5yIns"
        crossorigin="anonymous">
    <!-- Add icon library -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <script src="https://use.fontawesome.com/releases/v5.0.8/js/all.js"></script>
</head>

<body>
    <!--Nav bar-->
    <div>
        <div id="mySidenav" class="sidenav">
            <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
            <a href="">REVIEW</a>
            <a class="inSidenav" href="">Product Type</a>
            <a class="innerSidenav" href="cleanserList.html">cleanser</a>
            <a class="innerSidenav" href="moisturizerList.html">moisturizer</a>
            <a class="innerSidenav" href="bodyLotionList.html">body lotion</a>
            <a class="inSidenav" href="">Skin Concern</a>
            <a class="innerSidenav" href="AcneList.html">Acne</a>
            <a class="innerSidenav" href="BlackheadsList.html">Blackheads</a>
            <a class="innerSidenav" href="WrinklesList.html">Wrinkles</a>
            <a href="">ARTICLE</a>
            <a class="innerSidenav" href="DIYSkincareList.html">DIY Skincare</a>
            <a class="innerSidenav" href="NutritionList.html">Nutrition</a>
            <a class="innerSidenav" href="ExpertAdviceList.html">Expert Advice</a>
            <a href="myAccountPage.html">MY ACCOUNT</a>
        </div>
        &nbsp;&nbsp;&nbsp;&nbsp;<a class="backBtn" href="index.html"><i class="fas fa-chevron-left" style='font-size:24px'></i></a>&nbsp;&nbsp;&nbsp;
        <a class="title justify-content-center" href="#">SkincareMaster</a>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        <span style="font-size:30px;cursor:pointer" onclick="openNav()">&#9776; </span>
    </div>
    <!-- Search form -->
    <div>
        <form class="form-inline ">
            <input class="form-control form-control-sm mr-3 w-75" type="text" placeholder="Search eg: cleanser"
                aria-label="Search">
            <a class="searchBtn" href="cleanserList.html"><i class="fa fa-search" aria-hidden="true"></i></a>
        </form>
    </div>

    <script id="productDetail-template" type="text/x-handlebars-template">
        <div class="card" style="padding: 0rem">  
            <div class="card-body">
                <h5 class="card-title">{{company}}</h5>
                <img class="card-img-bottom" src="{{picture}}" alt="Product Page">
                <p class="card-text">{{productName}}</p>
                <p> Rating: {{rating}}</p>
               <i id="favIcon" onclick="favFunction(this)" class="far fa-heart float-right "></i>
            </div> 
        </div>  
    </script>




    <div id="templateProduct">

    </div>


    <h5 id="rvTitle" style="text-align: left">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REVIEW</h5>
    <button id="rvBtn" href="#" role="button" class="btn btn-secondary btn-sm" onclick="writeReview()"><i class="fas fa-pencil-alt"></i></button>


    <script id="review-template" type="text/x-handlebars-template">
        <div class="card">
                <h6 class="card-header">
                    <p> Rating : {{'rating'}} </p>
                </h6>
                <div class="card-body">
                    <p class="card-text">{{'comment'}}</p>
                </div>
        </div>
    </script>

    <div id="templateReview">

    </div>

    <script>
        var cleanser = [
            { 'company': 'Fresh', 'productName': 'Soy Face Cleanser', 'picture': 'img/cleanser3.jpg', 'rating': 5, 'index': 1, 'fav': 30 },
            { 'company': 'PHILOSOPHY', 'productName': 'Purity Made Simple Cleanser', 'picture': 'img/cleanser4.jpg', 'rating': 4, 'index': 2, 'fav': 40 },
            { 'company': 'EVE LOM', 'productName': 'Cleanser/Traitement De Nettoyage', 'picture': 'img/cleanser1.jpg', 'rating': 5, 'index': 3, 'fav': 50 },
            { 'company': 'SK-II', 'productName': 'Facial Treatment Cleanser', 'picture': 'img/cleanser2.jpg', 'rating': 5, 'index': 4, 'fav': 60 }
        ]
        var reviewList = [
            { 'rating': 5, 'comment': 'It is great' },
            { 'rating': 1, 'comment': 'It is not OK' },
            { 'rating': 2, 'comment': 'It is soso' },
            { 'rating': 3, 'comment': 'It is Ok' }
        ]

        function writeReview() {
            var qs = new URLSearchParams(window.location.search);
            var productName = qs.get("product");

            window.location = 'writeReview.html?product=' + productName;
        }

        function openNav() {
            document.getElementById("mySidenav").style.width = "250px";
        }
        function closeNav() {
            document.getElementById("mySidenav").style.width = "0";
        }
        function favFunction(x) {
            if (sessionStorage.getItem("isLoggedIn") == "yes") {
                x.classList.toggle("fas");
                var qs = new URLSearchParams(window.location.search);
                var productName = qs.get("product");
                var userName = sessionStorage.getItem("currentUser");

                var favoriteList = JSON.parse(localStorage.getItem(userName + "favoriteList"));
                var entry = {
                    "productName": productName
                };
                favoriteList.push(entry);
                localStorage.setItem(userName + "favoriteList", JSON.stringify(favoriteList));
            }
            else {
                alert("Please sign in first!");
            }


        }



        $(document).ready(function () {
            console.log('hello world');
            //get review list 
            for (var i = 0; i < cleanser.length; i++) {
                localStorage.setItem(cleanser[i]['productName'], JSON.stringify(reviewList));
            }
            var sourceP = $("#productDetail-template").html();
            var templateP = Handlebars.compile(sourceP);
            var parentDivP = $("#templateProduct");
            // BEGIN - STEP 1
            var queryParams = new URLSearchParams(window.location.search);
            var Name = queryParams.get('product');

            for (var i = 0; i < cleanser.length; i++) {
                var currData = cleanser[i];
                if (currData.productName == Name) {
                    var currHTML = templateP(currData);
                    parentDivP.append(currHTML);
                }
            }



            var sourceR = $("#review-template").html();
            var templateR = Handlebars.compile(sourceR);
            var parentDivR = $("#templateReview");

            var rList = JSON.parse(localStorage.getItem(Name + "ReviewList"));
            if (rList != null) {
                for (var j = 0; j < rList.length; j++) {
                    var currData = rList[j];
                    var currHTMLR = templateR(currData);
                    parentDivR.append(currHTMLR);
                }

            }


            for (var i = 0; i < reviewList.length; i++) {
                var currData = reviewList[i];
                var currHTMLR = templateR(currData);
                parentDivR.append(currHTMLR);
            }







        });


    </script>
    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/handlebars-v4.0.11.js"></script>

</body>

</html>